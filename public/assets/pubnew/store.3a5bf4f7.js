import{d as p,j as d}from"./bundle.d3169b93.js";import{f as L,$ as h,G as c,y as f,A as b}from"./index.63484d31.js";const o="kQDKZsjIASmOezxYG4CHo5Jyfg2b8FLpEvPXhw7UT1B0a9Rr3WtVnlqMidu6cN";function B(t){for(var s="",e=0;e<t.length;e++){var i=o.indexOf(t[e]);if(i==-1)var r=t[e];else var r=o[(i+3)%62];var a=parseInt(Math.random()*62+"",10),R=parseInt(Math.random()*62+"",10);s+=o[a]+r+o[R]}return s}function y(t){for(var s="",e=1;e<t.length;){var i=o.indexOf(t[e]);if(i==-1)var r=t[e];else var r=o[(i+59)%62];s+=r,e=e+3}return s}var M=(t=>(t[t.BET=1]="BET",t[t.READY=1.5]="READY",t[t.FLY=2]="FLY",t[t.CRASH=3]="CRASH",t))(M||{});const u=L();let m,l,n=!1;const N=p("ggame-crash",{state:()=>({windowY:0,openVoice:!0,showRecord:!1,lastBalance:"",lastResult:{},status:0,currentRate:1,nextRate:1,auto:!1,autoRate:1.8,money:1,betted:!1,roundWinStatus:0,roundWinMoney:0,totalBetMoney:"0",totalBetNum:0,totalWinMoney:"0",totalWinNum:0,airRecordList:[],runRecordList:[],reportList:[],roundList:[],recordList:[],leftTime:-1,roundUri:"",tradeNo:"",allBetThisRound:{},myBetThisRound:{}}),actions:{async init(){this.openVoice=!0,this.lastBalance=u.totalBalance,this.getMyBetRecordList(),this.getConfig(),this.getRoundList(),this.initSocket()},async getConfig(){const[t,s]=await h.get("/v1/crash/ini");if(t)return;const e=s.data||{};this.roundUri=e.roundUri,this.currentRate=1,this.leftTime=+e.betLeftTime,this.leftTime>11?this.status=1.5:this.status=e.status,this.totalBetNum=e.totalBetNum,this.totalBetMoney=e.totalBetMoney,this.totalWinMoney=e.totalWinMoney,this.totalWinNum=e.totalWinNum,this.resetBetTimer()},async getRoundList(){const[t,s]=await h.get("/v1/crash/round-list");if(t)return;const e=s.data||{};this.roundList=e.roundList,this.reportList=e.report},async getMyBetRecordList(){const[t,s]=await h.get("/v1/crash/list");t||(this.recordList=Array.isArray(s.data)?s.data:[])},async initSocket(){!await c.subscribe("game_crash")||c.bus.on(this.handleBus)},unSubscribe(){c.unSubscribe("game_crash"),c.bus.off(this.handleBus)},handleBus(t,s){this.handleSocketMsg(s)},handleSocketMsg(t){try{let s=JSON.parse(t.data)||{};const{type:e,data:i}=s;if(e!=="game_crash")return;const{method:r,item:a}=i;switch(r){case"run":return this.handleRun(a);case"open":return this.handleOpen(a);case"bet":return this.handleBet(a);case"end":return this.handleEnd(a);case"result":return this.handleResult(a)}}catch(s){console.log("%c [ handleSocketMsg error ]-139","font-size:13px; background:pink; color:#bf2c9f;",s)}},async handleRun(t){this.leftTime=0,this.resetBetTimer(),this.currentRate===1&&y(t.key),this.status=2;const s=y(t.key);this.currentRate=Number((Math.pow(+s/14+.3,4)+1).toFixed(2)),this.startFly(Date.now()-+s*1e3)},startFly(t){clearInterval(l),l=setInterval(()=>{const s=(Date.now()-t)/1e3;this.currentRate=Number((Math.pow(s/14+.3,4)+1).toFixed(2))},17)},async handleOpen(t){console.log("%c [ CRASH ]-240","font-size:13px; background:pink; color:#bf2c9f;",t),clearInterval(l),this.status=3,this.currentRate=+t.point,this.leftTime=t.leftTime,this.roundUri=t.nextUri,this.betted=!1,this.tradeNo="",this.resetBetTimer(),await f(3500),this.status=1,this.totalBetMoney="0",this.totalBetNum=0,this.totalWinMoney="0",this.totalWinNum=0,this.roundWinStatus=0,this.roundWinMoney=0,this.pushRoundList(t)},handleBet(t){this.currentRate=1,this.status=1,this.totalBetMoney=t.totalBetMoney,this.totalBetNum=t.totalBetNum,this.pushAirRecordList(t)},handleEnd(t){this.totalWinMoney=t.totalWinMoney,this.totalWinNum=t.totalWinNum,this.pushRunRecordList(t)},handleResult(t){this.totalWinMoney=t.totalWinMoney,this.totalWinNum=t.totalWinNum,t.status===2?this.roundWinMoney=+t.winMoney:this.roundWinMoney=+t.betMoney,this.roundWinStatus=t.status,u.totalBalance=t.balance,this.pushMyBetRecordList(t)},handleRefund(t){},resetBetTimer(){clearInterval(m);const t=new Date().getTime(),s=this.leftTime;m=setInterval(()=>{const e=(new Date().getTime()-t)/1e3,i=Number(Math.max(0,s-e).toFixed(1));i<=0?(this.leftTime=0,clearInterval(m)):this.leftTime=i},60)},async bet(){if(n||this.status!==1||!this.money)return;n=!0;const t={roundUri:this.roundUri,money:this.money};this.auto&&(t.autoEndPoint=this.autoRate);const[s,e]=await h.post("/v1/crash/bet",t);if(n=!1,s)return!1;this.tradeNo=e.data.tradeNo,u.totalBalance=(b(u.totalBalance)-+this.money).toFixed(2),this.betted=!0,d.success("Bet Sucesso")},async run(){if(n||this.status!==2||!this.betted)return;n=!0;const t={key:B(this.currentRate+""),tradeNo:this.tradeNo,roundUri:this.roundUri};let s=setTimeout(()=>{n&&d.loading({forbidClick:!0})},3e3);const[e,i]=await h.post("/v1/crash/end",t);if(clearTimeout(s),n=!1,e)return!1;d.clear(),this.betted=!1},reset(){this.status=0,this.openVoice=!1,this.money=1,this.betted=!1,this.tradeNo="",this.unSubscribe(),clearInterval(l)},async pushAirRecordList(t){this.airRecordList.unshift(t),this.airRecordList.length>60&&(this.airRecordList=this.airRecordList.slice(60));try{const s=document.querySelector(".crash-rocket-wrap"),e=document.createElement("div");e.classList.add("bet-air-item-ani","fs12","h30","br20","pall6"),e.innerHTML=`${t.name} Bet R$${t.money}`,s.appendChild(e),await f(1500),s.removeChild(e)}catch(s){}},pushRoundList(t){this.roundList.unshift(t),this.roundList.length>200&&(this.roundList=this.roundList.slice(0,200))},pushMyBetRecordList(t){!t.tradeNo||(this.recordList.unshift(t),this.recordList.length>60&&(this.recordList=this.recordList.slice(0,60)))},async pushRunRecordList(t){this.runRecordList.unshift(t),this.runRecordList.length>60&&(this.runRecordList=this.runRecordList.slice(0,60));try{const s=document.querySelector(".crash-rocket-wrap"),e=document.createElement("div");e.classList.add("bet-air-item-ani","run","fs12","h30","br20","pall6"),e.innerHTML=`${t.name} bento R$${t.winMoney}`,s.appendChild(e),await f(1500),s.removeChild(e)}catch(s){}}}});export{M as S,N as s};
